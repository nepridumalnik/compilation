<!doctype html>
<html lang="ru">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Виртуальная примерочная — поиск</title>
    <style>
        * {
            box-sizing: border-box
        }

        body {
            margin: 0;
            font-family: Inter, Arial, sans-serif;
            display: flex;
            height: 100vh;
            color: #111
        }

        .sidebar {
            flex: 0 0 24%;
            background: #f6f7f9;
            padding: 16px;
            border-right: 1px solid #e2e8f0;
            overflow: auto
        }

        .main {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #fff
        }

        .right {
            flex: 0 0 32%;
            background: #fafafa;
            padding: 16px;
            border-left: 1px solid #e2e8f0;
            overflow: auto
        }

        h2 {
            font-size: 16px;
            margin: 8px 0 12px
        }

        .group {
            margin-bottom: 16px
        }

        label {
            font-size: 12px;
            color: #475569;
            margin-bottom: 6px;
            display: block
        }

        textarea {
            width: 100%;
            min-height: 56px;
            padding: 8px;
            border: 1px solid #cbd5e1;
            border-radius: 10px;
            font-size: 14px
        }

        button {
            margin-top: 8px;
            padding: 8px 10px;
            border: 0;
            border-radius: 10px;
            background: #2563eb;
            color: #fff;
            font-size: 14px;
            cursor: pointer
        }

        button:disabled {
            opacity: .5;
            cursor: not-allowed
        }

        .silhouette {
            max-height: 90vh;
            max-width: 80%;
            object-fit: contain;
            filter: brightness(0) saturate(0) invert(50%)
        }

        .section {
            margin-bottom: 20px
        }

        .cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px
        }

        .card {
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            background: #fff
        }

        .card img {
            width: 100%;
            height: 110px;
            object-fit: cover;
            display: block
        }

        .score {
            font-size: 12px;
            color: #475569;
            padding: 6px
        }

        @media (max-width:980px) {
            body {
                flex-direction: column
            }

            .sidebar,
            .main,
            .right {
                flex: none;
                width: 100%;
                height: auto
            }
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <h2>Промпты по категориям</h2>

        <div class="group">
            <label for="prompt-hats">Головные уборы</label>
            <textarea id="prompt-hats" placeholder="напр.: чёрная вязаная шапка для зимы"></textarea>
            <button data-category="hats">Искать</button>
        </div>

        <div class="group">
            <label for="prompt-outerwear">Верхняя одежда</label>
            <textarea id="prompt-outerwear" placeholder="напр.: чёрный худи без принта"></textarea>
            <button data-category="outerwear">Искать</button>
        </div>

        <div class="group">
            <label for="prompt-pants">Штаны</label>
            <textarea id="prompt-pants" placeholder="напр.: широкие классические брюки серые"></textarea>
            <button data-category="pants">Искать</button>
        </div>

        <div class="group">
            <label for="prompt-shoes">Обувь</label>
            <textarea id="prompt-shoes" placeholder="напр.: серые замшевые слипоны"></textarea>
            <button data-category="shoes">Искать</button>
        </div>
    </div>

    <div class="main">
        <img class="silhouette" src="https://upload.wikimedia.org/wikipedia/commons/8/83/SVG_Human_Silhouette.svg"
            alt="Силуэт">
    </div>

    <div class="right">
        <div id="results"></div>
    </div>

    <script>
        async function query(category, prompt) {
            const u = new URL("/api/search", location.origin);
            u.searchParams.set("category", category);
            u.searchParams.set("prompt", prompt);
            const res = await fetch(u);
            if (!res.ok) throw new Error("search failed");
            return res.json();
        }

        function render(category, data) {
            const root = document.getElementById("results");
            const section = document.createElement("div");
            section.className = "section";
            section.innerHTML = `<h2>${title(category)}</h2><div class="cards"></div>`;
            const grid = section.querySelector(".cards");
            (data.items || []).forEach(it => {
                const card = document.createElement("div");
                card.className = "card";
                card.innerHTML = `<img src="${it.image_url}" alt=""><div class="score">score: ${it.score.toFixed(4)}</div>`;
                grid.appendChild(card);
            });
            root.prepend(section);
        }

        function title(cat) {
            return ({
                "hats": "Головные уборы",
                "outerwear": "Верхняя одежда",
                "pants": "Штаны",
                "shoes": "Обувь"
            })[cat] || cat;
        }

        document.querySelectorAll("button[data-category]").forEach(btn => {
            btn.addEventListener("click", async () => {
                const cat = btn.getAttribute("data-category");
                const ta = document.getElementById(`prompt-${cat}`);
                const prompt = ta.value.trim();
                if (!prompt) return;
                btn.disabled = true;
                try {
                    const data = await query(cat, prompt);
                    render(cat, data);
                } catch (e) {
                    alert("Ошибка поиска");
                } finally {
                    btn.disabled = false;
                }
            });
        });
    </script>
</body>

</html>